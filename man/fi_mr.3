.TH "FI_MR" 3 "2014-02-06" "libfabric" "Libfabric Programmer's Manual" libfabric
.SH NAME
fi_mr \- Memory region operations
.PP
fi_mr_reg / fi_mr_regv / fi_mr_regattr
.RS
Register local memory buffers for direct fabric access
.RE
.PP
fi_mr_unreg
.RS
Deregister registerd memory buffers.
.RE
.PP
fi_mr_desc
.RS
Return a local descriptor associated with a registered memory region
.RE
.PP
fi_mr_key
.RS
Return the remote key needed to access a registered memory region
.RE
.PP
fi_mr_bind
.RS
Associate a registered memory region with an event collector.
.RE
.SH SYNOPSIS
.B #include <rdma/fi_domain.h>
.HP
.BI "int fi_mr_reg(fid_t " fid ","
.BI "const void * " buf ", size_t " len ","
.BI	"uint64_t " access ", uint64_t " requested_key ","
.BI "uint64_t " flags ", fid_t *" mr ", void *" context ");"
.HP
.BI "int fi_mr_regv(fid_t " fid ","
.BI "const struct iovec * " iov ", size_t " count ","
.BI	"uint64_t " access ", uint64_t " requested_key ","
.BI "uint64_t " flags ", fid_t *" mr ", void *" context ");"
.HP
.BI "int fi_mr_regattr(fid_t " fid ","
.BI "const struct fi_mr_attr * " attr ","
.BI "uint64_t " flags ", fid_t *" mr ");"
.PP
.HP
.BI "int fi_mr_unreg(fid_t " mr ");"
.PP
.HP
.BI "uint64_t fi_mr_desc(fid_t " mr ");"
.HP
.BI "uint64_t fi_mr_key(fid_t " mr ");"
.PP
.HP
.BI "int fi_mr_bind(fid_t " mr ", " fid_t " ec ", uint64_t " flags ");"
.SH ARGUMENTS
.IP "fid"
Resource domain
.IP "mr"
Memory region 
.IP "ec"
Event collector
.IP "context"
User specified context associated with the memory region.
.IP "buf"
Memory buffer to register with the fabric hardware
.IP "len"
Length of memory buffer to register
.IP "iov"
Vectored memory buffer.
.IP "count"
Count of vectored buffer entries.
.IP "access"
Memory access permissions associated with registration
.IP "requested_key"
Requested remote key associated with registered buffers
.IP "attr"
Memory region attributes
.IP "flags"
Additional flags to apply to the operation.
.SH "DESCRIPTION"
Registered memory regions associate memory buffers with permissions
granted for access by fabric resources.  A memory buffer must be
registered with a resource domain before it can be used as the target
of a remote RMA or atomic data transfer.  Additionally, a fabric
provider may require that data buffers be registered before being
used in local transfers.
.PP
A provider may hide local registration requirements from applications
by making use of an internal registration cache or similar mechanisms.
Such mechanisms, however, may negatively impact performance for some
applications, notably those which manage their own network buffers.
In order to support as broad range of applications as possible, without
unduly affecting their performance, applications that wish to manage
their own local memory registrations may do so by using the memory
registration calls.
.PP
The registrations functions -- fi_mr_reg, fi_mr_regv, and fi_mr_regattr --
are used to register one or more memory buffers with fabric resources.
The main difference between registration functions are the number
and type of parameters that they accept as input.  Otherwise,
they perform the same general function.
.SS "fi_mr_reg"
The fi_mr_reg call registers the user-specified memory buffer with
the resource domain.  The buffer is enabled for access by the fabric
hardware based on the provided access permissions.  Supported access
permissions are the bitwise OR of the following:
.IP "FI_SEND"
The memory buffer may be used in outgoing message data transfers.  This
includes fi_msg and fi_tagged operations.
.IP "FI_RECV"
The memory buffer may be used to receive inbound message transfers.
This includes fi_msg and fi_tagged operations.
.IP "FI_READ"
The memory buffer may be used as the result buffer for RMA read
and atomic operations on the initiator side.  If FI_REMOTE is set as well,
then the memory buffer may also be used as the source of an RMA read
operation on the target side.
.IP "FI_WRITE"
The memory buffer may be used as the source buffer for RMA write
and atomic operations on the initiator side.  If FI_REMOTE is set as well,
then the memory buffer may also be used as the target of an RMA write
or atomic operation.
.IP "FI_REMOTE"
The memory buffer may be the target of a remote RMA or atomic operation.
.PP
Registered memory is associated with a local memory descriptor and,
optionally, a remote memory key.  A memory descriptor is a provider
specific identifier associated with registered memory.  Memory descriptors
often map to hardware specific indices or keys associated with the
memory region.  Remote memory keys provide limited protection against
unwanted access by a remote node.  Remote accesses to a memory region
must provide the key associated with the registration.
.PP
Because MR keys must be provided by a remote process, an application
can use the requested_key parameter to indicate that a specific key
value be returned.  A requested_key value of 0 indicates that the
provider can select any appropriate key.  Support for user requested keys
is provider specific.
.PP
By default, memory registration is an asynchronous operation.  The result
of a registration request will be reported to the user through an event
queue associated with the resource domain.  If successful, the allocated
memory region structure will be returned to the user through the mr
parameter.  The mr address must remain valid until the registration
operation completes.  The context specified with the registration request
is returned with the completion event.
.SS "fi_mr_regv"
The fi_mr_regv call adds support for a scatter-gather list to fi_mr_reg.
Multiple memory buffers are registered as a single memory region.
Otherwise, the operation is the same. 
.SS "fi_mr_regattr"
The fi_mr_regattr call is a more generic, extensible registration call
that allows the user to specify the registration request using a struct
fi_mr_attr.
.PP
.nf
struct fi_mr_attr {
	int                mask;          /* mask of valid fields */
	const struct iovec *mr_iov;       /* scatter-gather array */
	size_t             iov_count;     /* # elements in mr_iov */
	uint64_t           access;        /* access permission flags */
	uint64_t           requested_key; /* requested remote key */
	void               *context;      /* user-defined context */
};
.fi
.SS "fi_mr_unreg"
The fi_mr_unreg call is used to release all resources associated with a
registering a memory region.  Once unregistered, further access to the
registered memory is not guaranteed.  For performance reasons,
unregistration processing may be done asynchronously or lazily.  To force
all queued unregistration requests to complete, applications may call
fi_domain_sync.  Upon completion of an fi_domain_sync call, all memory
regions unregistered before fi_domain_sync was invoked will have completed,
and no further access to the registered region, either locally or remotely,
via fabric resources will be possible. 
.SS "fi_mr_desc / fi_mr_key"
The local memory descriptor and remote protection key associated with a
MR may be obtained by calling fi_mr_desc and fi_mr_key, respectively.
The memory registration must have completed successfully before invoking
these calls.
."fi_mr_bind"
The fi_mr_bind function associates a memory region with an event collector,
for providers that support the generation of events based on fabric
operations.  The type of events tracked against the memory region is
based on the bitwise OR of the following flags.
.IP "FI_WRITE"
Generates an event whenever a remote RMA write or atomic operation modify
the memory region.
.SH "FLAGS"
The following flags are usable with fi_mr_reg, fi_mr_regv, fi_mr_regattr.
.IP "FI_BLOCK"
Indicates that the memory registration call should operate synchronously.
If set, the call will block until the registration completes.
.SH "RETURN VALUES"
Returns 0 on success.  On error, a negative value corresponding to
fabric errno is returned.
.PP
Fabric errno values are defined in
.IR "rdma/fi_errno.h".
.SH "ERRORS"
.IP "-FI_ENOKEY"
The requested_key is already in use.
.IP "-FI_EKEYREJECTED"
The requested_key is not available.  They key may be out of the range
supported by the provider, or the provider may not support user-requested
memory registration keys.
.IP "-FI_ENOSYS"
Returned by fi_mr_bind if the provider does not support reporting events
based on access to registered memory regions.
.IP "-FI_EBADFLAGS"
Returned if the specified flags are not supported by the provider.
.SH "SEE ALSO"
fi_getinfo(3), fi_endpoint(3), fi_domain(3), fi_rma(3), fi_msg(3), fi_atomic(3)
